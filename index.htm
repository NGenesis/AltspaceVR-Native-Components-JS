<html>
	<head>
		<title>AltspaceVR Native Components in JS</title>
		<script type="text/javascript" src="https://cdn.rawgit.com/mrdoob/three.js/dev/build/three.js"></script>
		<script type="text/javascript" src="https://sdk.altvr.com/libs/altspace.js/0.25.0/altspace.min.js"></script>
		<script type="text/javascript" src="js/JSNativeComponents.js"></script>
		<script>
			var TestApp = (function() {
				var scene = new THREE.Scene();
				var renderer = altspace.getThreeJSRenderer();
				var root = new THREE.Object3D();
				
				var myClock;
				var testCollider;
				
				scene.add(root);
				
				function init() {

					altspace.getEnclosure().then(function(enc) {
						console.log('Enclosure Data:', enc);
						root.scale.multiplyScalar(enc.pixelsPerMeter);
						
						loadAssets();
					});

				}
				
				function loadAssets() {
					myClock = new NativeComponent('n-text', {
						fontSize: 10,
						width: 10,
						height: 1,
						horizontalAlign: 'middle',
						verticalAlign: 'middle'	
					}).addTo(root);
					
					var geometry = new THREE.BoxGeometry(5, 5, 5);
					var material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
					var testBox = new THREE.Mesh(geometry, material);
					testBox.position.x = -10;
					
					testCollider = new NativeComponent('n-box-collider', {
						center: THREE.Vector3(0, 0, 0),
						radius: 0,
						type: 'environment'
					}, testBox).addTo(root);
					
					animate();
				}
				
				function animate() {
					
					var epochtime = (new Date).getTime();
					
					myClock.update({ text: String(epochtime) }, function(obj) {
						obj.rotation.y += 0.001;
					});
					
					testCollider.getMesh(function(obj) {
						obj.rotation.y += 0.002;
					});
					
					requestAnimationFrame(animate);
					renderer.render(scene);
				}
				
				return { init: init };
			}());
			
			window.onload = function() {
				TestApp.init();	
			}
		</script>
	</head>
	<body>

	</body>
</html>
